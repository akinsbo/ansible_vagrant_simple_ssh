---
  - hosts: vagrant-machine
    tasks:
      - name: just pinging
        ping: ~

      # - name: Upgrade installed packages
      #   become: true
      #   apt:
      #     upgrade: safe

      - name: Add PHP 7 PPA repository
        become: true
        apt_repository:
          repo: 'ppa:ondrej/php'
      
      - name: Install LEMP packages
        become: true
        apt:
          name: "{{ item }}"
          state: latest
          update_cache: yes
        with_items:
          - cowsay
          - php7.2-cli
          - php7.2-curl
          - php7.2-fpm
          - php7.2-intl
          - php7.1-mysql
          - nginx
          - mysql-server
          - git
      
      # - name: Set datetimezone for FPM
      #   become: true
      #   lineinfile:
      #     dest: /etc/php/7.2/cli/php.ini
      #     regexp: "date.timezone ="
      #     line: "date.timezone = UTC"
      
      - name: Set date.timezone for FPM
        become: true
        ini_file:
          dest: /etc/php/7.2/cli/php.ini
          section: "{{item.section}}"
          option: "{{item.option}}"
          value: "{{item.value}}"
          backup: yes
        with_items:
          - { section: Date, option: date.timezone, value: Africa/Lagos }
          - { section: PHP, option: max_execution_time, value: 60 }
          - { section: PHP, option: memory_limit, value: 512M }
